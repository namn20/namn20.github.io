---
layout: post
title: "Semgrep과 Cursor를 활용한 코드 보안 및 기능 진단 가이드"
date: 2026-01-20
categories: [Security, DevTools, AI]
tags: [semgrep, cursor, sast, mcp]
---

개발자로서 우리는 항상 "안전한 코드"와 "잘 돌아가는 코드" 두 마리 토끼를 잡아야 합니다. 오늘은 정적 분석 도구인 **Semgrep**과 AI 기반 에디터인 **Cursor**를 활용하여, 소스코르의 보안 취약점을 자동으로 찾아내고 기능적 문제를 진단하는 워크플로우를 소개합니다.

나아가, 차세대 AI 도구 연동 표준인 **MCP(Model Context Protocol)**가 이 과정을 어떻게 혁신할 수 있을지도 간단히 언급하겠습니다.

## 1. 개요

- **Semgrep (Semantic Grep)**: 빠르고 간편한 정적 분석 도구(SAST)입니다. 단순한 문자열 매칭이 아니라 코드의 구조(AST)를 이해하여 패턴을 검색하므로 오탐이 적고 정확합니다. CLI 환경에서 강력한 성능을 발휘합니다.
- **Cursor**: VS Code 기반의 AI 네이티브 에디터입니다. GPT-4나 Claude 같은 LLM이 내장되어 있어, 코드 작성뿐만 아니라 수정, 리팩토링, 버그 분석에 탁월합니다.

이 두 도구를 함께 사용하면 **"Semgrep으로 문제를 찾고, Cursor로 문제를 해결(또는 심층 분석)"**하는 강력한 루프를 만들 수 있습니다.

---

## 2. Semgrep CLI를 이용한 취약점 진단

Semgrep은 CLI(Command Line Interface)에서 실행하는 것이 가장 기본적이고 강력합니다. CI/CD 파이프라인에 넣기도 좋고, 로컬에서 빠르게 돌려보기도 좋습니다.

### 2.1 설치

파이썬(Python)이 설치되어 있다면 `pip`로 쉽게 설치할 수 있습니다. (또는 brew, docker 등도 지원)

```bash
# 설치
pip install semgrep

# 버전 확인
semgrep --version
```

### 2.2 기본 스캔 (Auto Config)

프로젝트 루트 디렉토리에서 아래 명령어를 실행하면, Semgrep 레지스트리에서 추천하는 보안 규칙(Ruleset)을 자동으로 적용하여 스캔합니다.

```bash
# 현재 디렉토리에 대해 자동 설정으로 스캔
semgrep scan --config=auto
```

이 명령어 하나만으로도 SQL Injection, XSS, 하드코딩된 비밀번호 등 일반적인 보안 취약점을 꽤 많이 찾아냅니다.

### 2.3 결과 확인 및 포맷팅

스캔 결과는 터미널에 출력되지만, 파일로 저장해서 보고 싶다면 `--json` 또는 `--text` 옵션을 활용할 수 있습니다.

```bash
# 결과를 output.txt에 저장
semgrep scan --config=auto > output.txt
```

---

## 3. Cursor를 활용한 기능 진단 및 취약점 조치

Semgrep이 "여기에 보안 문제가 있어!"라고 알려준다면, Cursor는 "그게 왜 문제이고, 어떻게 고쳐야 하며, 이 코드가 원래 의도한 기능은 무엇인지"를 알려주는 역할을 합니다.

### 3.1 워크플로우 예시

1.  **Cursor에서 터미널 열기**: Cursor 에디터 내의 터미널(Ctrl+`)을 열고 `semgrep scan`을 실행합니다.
2.  **취약점 발견**: 예를 들어, `requests.get(url, verify=False)` 같은 코드가 발견되었다고 가정합시다.
3.  **Cursor AI에게 질문하기 (Cmd+K 또는 Chat)**:
    *   발견된 코드 블럭을 드래그합니다.
    *   `Cmd+K`를 누르고 질문합니다.
    *   *"Semgrep에서 여기서 SSL 검증을 비활성화했다고 경고가 떴어. 이걸 안전하게 고치려면 어떻게 해야 해? 그리고 이 코드가 하는 역할이 정확히 뭐야?"*

### 3.2 기능 진단 (Functional Diagnosis)

보안 문제 외에도, 코드가 의도대로 동작하는지 검증하는 데 Cursor가 유용합니다.

*   **로직 설명 요청**: *"이 함수가 데이터베이스 트랜잭션을 처리하는 로직이 올바른지 설명해줘. 예외 처리가 빠진 부분은 없어?"*
*   **테스트 케이스 생성**: *"이 비즈니스 로직을 검증하기 위한 단위 테스트 코드를 작성해줘."*

Semgrep이 **구조적/패턴적 오류**를 잡는다면, Cursor는 **맥락적/논리적 오류**를 잡는 데 탁월합니다.

---

## 4. MCP (Model Context Protocol) 란 무엇인가?

글을 마치기 전, 질문 주신 **MCP**에 대해 간단히 짚고 넘어가겠습니다.

지금 우리는 **Terminal(Semgrep) -> Copy/Paste -> Cursor AI**의 과정을 거치고 있습니다. 사람이 중간에서 도구 결과를 AI에게 전달해줘야 하죠.

**MCP (Model Context Protocol)**는 Anthropic이 제안한 개방형 표준으로, **AI 모델이 외부 데이터나 도구(Tool)에 직접 안전하게 접근할 수 있도록 하는 규약**입니다.

### MCP가 적용된 미래의 워크플로우

만약 Semgrep이 MCP 서버로 구현되어 있고, Cursor(또는 다른 AI 에이전트)가 MCP 클라이언트로 연결된다면 어떻게 될까요?

1.  사용자가 AI에게 *"이 프로젝트 보안 점검해줘"* 라고 말합니다.
2.  **AI가 직접 Semgrep 도구를 호출**하여 스캔을 수행합니다. (사람이 명령어를 칠 필요 없음)
3.  스캔 결과를 AI가 **직접 읽어들여** 분석합니다.
4.  AI가 취약점이 발견된 파일을 **직접 열어서 수정 제안**을 합니다.

즉, **"도구의 실행 결과"를 AI가 문맥(Context)으로 바로 이해**하게 해주는 연결 고리가 바로 MCP입니다. 추후 여러분의 보안 진단 시스템을 자동화할 때, MCP 서버를 구축해두면 어떤 AI 모델이든 쉽게 붙여서 진단을 수행하게 만들 수 있을 것입니다.

---

## 마무리

*   1차 필터링: **Semgrep CLI**로 빠르고 확실한 패턴 매칭 보안 진단
*   2차 분석 및 수정: **Cursor**로 문맥 기반 상세 분석 및 코드 수정
*   미래 확장: **MCP**를 도입하여 이 과정을 완전 자동화된 에이전트 워크플로우로 발전

이 글이 여러분의 안전하고 똑똑한 코딩 생활에 도움이 되기를 바랍니다!
